# 选股筛选功能使用说明

## 功能概述

基于`stock_business`大宽表的增强选股筛选功能，支持多维度条件筛选和动态查询条件，帮助用户发现投资机会。

## 主要特性

### 1. 基本筛选条件
- **行业筛选**：支持按行业分类筛选
- **地域筛选**：支持按地域分类筛选  
- **市场筛选**：支持深圳(SZ)、上海(SH)市场筛选
- **数据日期**：可指定特定日期的数据，留空则使用最新数据

### 2. 估值指标筛选
- **市盈率(PE)**：支持最小值-最大值范围筛选
- **市净率(PB)**：支持最小值-最大值范围筛选
- **市销率(PS)**：支持最小值-最大值范围筛选
- **股息率**：支持最小值-最大值范围筛选

### 3. 市值与交易指标
- **总市值**：支持按总市值范围筛选（万元）
- **流通市值**：支持按流通市值范围筛选（万元）
- **换手率**：支持按换手率范围筛选（%）
- **量比**：支持按量比范围筛选

### 4. 技术指标筛选
- **RSI(6日)**：相对强弱指标
- **KDJ-K值**：随机指标K值
- **MACD**：指数平滑移动平均线
- **CCI指标**：顺势指标

### 5. 资金流向筛选
- **净流入额**：当日净流入资金（万元）
- **大单买入占比**：大单买入金额占比（%）
- **5日净流入额**：5日累计净流入资金（万元）

### 6. 动态查询条件（核心功能）

支持灵活的字段间比较和固定值比较：

#### 字段间比较示例：
- `MA5 > MA10`：5日均线大于10日均线
- `PE < PB`：市盈率小于市净率
- `RSI(6日) >= KDJ-K值`：RSI指标大于等于KDJ-K值

#### 固定值比较示例：
- `PE < 15`：市盈率小于15
- `换手率 > 5`：换手率大于5%
- `净流入额 >= 1000`：净流入额大于等于1000万

#### 支持的操作符：
- `>`：大于
- `>=`：大于等于
- `<`：小于
- `<=`：小于等于
- `=`：等于
- `!=`：不等于

#### 可用字段分类：

**基本信息**
- 收盘价、涨跌额、涨跌幅(%)

**估值指标**
- 市盈率(PE)、市盈率(TTM)、市净率(PB)、市销率(PS)、市销率(TTM)、股息率(%)、股息率(TTM)(%)

**市值交易**
- 总市值(万)、流通市值(万)、换手率(%)、换手率(自由流通)、量比、成交量、成交额

**技术指标**
- MACD DIF、MACD DEA、MACD、KDJ K值、KDJ D值、KDJ J值、RSI(6日)、RSI(12日)、RSI(24日)、布林上轨、布林中轨、布林下轨、CCI指标

**均线指标**
- MA5、MA10、MA20、MA30、MA60、MA120

**资金流向**
- 净流入额、5日净流入额、大单买入额、大单买入占比(%)、中单买入额、中单买入占比(%)、小单买入额、小单买入占比(%)

## 使用方法

### 1. 基础筛选
1. 访问 `/screen` 页面
2. 在各个分类中设置筛选条件
3. 点击"开始筛选"按钮

### 2. 添加动态条件
1. 在"动态查询条件"区域点击"添加条件"
2. 选择字段A（如：MA5）
3. 选择操作符（如：>）
4. 选择字段B（如：MA10）或选择"固定数值"并输入值
5. 可添加多个动态条件

### 3. 模板管理
- **保存模板**：点击"保存模板"按钮，输入模板名称保存当前筛选条件
- **加载模板**：点击"加载模板"按钮，选择之前保存的模板

### 4. 结果操作
- **查看详情**：点击股票行的"详情"按钮查看股票详细信息
- **技术分析**：点击"分析"按钮进入技术分析页面
- **导出结果**：点击"导出"按钮下载CSV格式的筛选结果

## 使用示例

### 示例1：寻找低估值银行股
```
行业：银行
PE：5-15
PB：0.5-1.2
动态条件：MA5 > MA10（技术面向好）
```

### 示例2：寻找高成长科技股
```
行业：软件服务
地域：深圳
总市值：100000-500000万
动态条件1：PE < 30
动态条件2：换手率 > 3
动态条件3：净流入额 > 1000
```

### 示例3：寻找技术突破股票
```
动态条件1：MA5 > MA20
动态条件2：RSI(6日) > 50
动态条件3：MACD > 0
动态条件4：换手率 > 2
```

## 注意事项

1. **数据限制**：筛选结果限制在200条以内，如需更精确结果请使用更多筛选条件
2. **数据日期**：默认使用最新数据，可指定特定日期查看历史筛选结果
3. **动态条件**：字段间比较时，两个字段都必须有数值才会参与比较
4. **模板存储**：模板保存在浏览器本地存储中，清除浏览器数据会丢失模板

## API接口

### 筛选接口
```
POST /api/analysis/screen
Content-Type: application/json

{
  "industry": "银行",
  "market": "SZ", 
  "pe_min": "5",
  "pe_max": "15",
  "dynamic_conditions": [
    {
      "field_a": "ma5",
      "operator": ">", 
      "field_b": "ma10"
    },
    {
      "field_a": "pb",
      "operator": "<",
      "value": "1.5"
    }
  ]
}
```

### 响应格式
```json
{
  "code": 200,
  "data": {
    "stocks": [...],
    "total": 8,
    "has_more": false,
    "criteria": {...}
  }
}
```

## 技术实现

- **后端**：基于SQLAlchemy ORM，使用`stock_business`大宽表进行高效查询
- **前端**：原生JavaScript + Bootstrap，支持动态条件添加和模板管理
- **数据源**：股票业务大宽表，包含日线、技术指标、资金流向等综合数据
- **缓存**：支持Redis缓存，提高查询性能

## 更新日志

- **v1.0**：基础筛选功能
- **v2.0**：增加动态查询条件功能
- **v2.1**：增加模板保存和加载功能
- **v2.2**：完善字段映射和用户体验 